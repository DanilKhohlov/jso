{"version":1,"files":[{"name":"m.js","type":"file","data":"const vkt = require('./modules/vk-tools');\r\nconst { VK } = require('vk-io');\r\nconst fs = require('fs');\r\nconst updateTools = require('./update');\r\nlet i = 2;\r\n\r\n(function() {\r\n    updateTools.checkAndLoad()\r\n    .then(() => {\r\n        vkt.tools.auth(!vkt.tools.isConfindFind() ? {\r\n            login: process.argv[2],\r\n            password: process.argv[3]\r\n        } : {\r\n            saved: true\r\n        })\r\n        .then((data => {\r\n            console.log('Успешная авторизация.');\r\n            const vk = new VK({\r\n                token: data.token\r\n            });\r\n            const { updates, snippets, upload } = vk;\r\n            let peers = [];\r\n            \r\n            vk.updates.on('message_new', async (msg) => {\r\n                if (msg.senderId === -171493284) {\r\n                    const regexp = msg.text?.match(/в этой беседе уже забрали подарок, он появится через ([0-9]+) .*, ([0-9]+) .*./i);\r\n                    if (regexp) {\r\n                        let f = peers.filter(x => x.peer_id === msg.chatId)[0];\r\n                        if (!f) {\r\n                            peers.push({\r\n                                peer_id: msg.chatId,\r\n                                tm: null,\r\n                                gifts: 0,\r\n                                time: Date.now()\r\n                            });\r\n                            f = peers.filter(x => x.peer_id === msg.chatId)[0];\r\n                        };\r\n                        if (!f.tm) {\r\n                            const minutes = Number(regexp[1]),\r\n                            seconds = Number(regexp[2]);\r\n                            const milliseconds = (((minutes * 60) + seconds) * 1000);\r\n            \r\n                            f.tm = setTimeout(() => {\r\n                                f.tm = null;\r\n                                f.gifts++;\r\n                                msg.send(`Подарок`);\r\n                                setTimeout(() => {\r\n                                    msg.send(`Подарок`);\r\n                                }, 12000);\r\n                            }, milliseconds + 700);\r\n                        } else return;\r\n                    }\r\n                };\r\n                if (msg.senderId !== data.id) return;\r\n            \r\n                if (msg.text.match(/^stat/i)) {\r\n                    msg.send(`Статистика бесед, подключенных к боту:\\n ${(() => {\r\n                        let text = ``;\r\n                        for (let i = 0; i < peers.length; i++) {\r\n                            text += `${peers[i].peer_id}ID: подарков - ${peers[i].gifts}; время работы - ${Math.floor((Date.now() - peers[i].time) / 60000)} мин.\\n`;\r\n                        };\r\n            \r\n                        return text;\r\n                    })()}`);\r\n                };\r\n            });\r\n        \r\n            console.log(`Бот запущен, ваш id: ${data.id}`);\r\n            \r\n            vk.updates.start();\r\n        }))\r\n        .catch(error => {\r\n            console.log(`Ошибка авторизации: ${error}`);\r\n            process.exit(0);\r\n        });\r\n    })\r\n    .catch(() => process.exit(0));\r\n})();"},{"name":"config-file.json","type":"file","data":"{\"token\":\"b280499cfc527a98003727d43ea1d65906a7d3f782ce11313923cb62afcad54a89f976554e4249911e242\",\"id\":482598586}"}]}
